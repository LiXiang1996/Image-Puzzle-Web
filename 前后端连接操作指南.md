# 前后端连接操作指南

## 📋 操作步骤（按顺序执行）

### 第一步：安装后端依赖

打开终端，进入后端项目目录：

```bash
cd /Users/lixiang/PycharmProjects/PythonProject
```

安装Python依赖：

```bash
pip install -r requirements.txt
```

如果遇到权限问题，可以使用：
```bash
pip install --user -r requirements.txt
```

### 第二步：启动后端服务

在后端项目目录下，运行：

```bash
python main.py
```

或者使用 uvicorn（推荐，支持热重载）：

```bash
uvicorn main:app --host 0.0.0.0 --port 8080 --reload
```

**看到类似以下输出说明启动成功：**
```
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

**重要：保持这个终端窗口打开，不要关闭！**

### 第三步：验证后端服务

打开浏览器访问：http://localhost:8080/docs

你应该能看到 FastAPI 的自动生成文档页面（Swagger UI），这说明后端服务正常运行。

### 第四步：启动前端项目

**打开一个新的终端窗口**（不要关闭后端服务的终端），进入前端项目目录：

```bash
cd /Users/lixiang/vue-project
```

启动前端开发服务器：

```bash
npm run dev
```

**看到类似以下输出说明启动成功：**
```
  VITE v6.0.5  ready in xxx ms

  ➜  Local:   http://localhost:3000/
  ➜  Network: use --host to expose
```

### 第五步：测试前后端连接

1. 浏览器会自动打开 http://localhost:3000（如果没有自动打开，手动访问）
2. 尝试注册一个新用户
3. 尝试登录
4. 测试其他功能（创建作品、查看消费记录等）

## 🔧 配置说明

### 前端代理配置
前端已经配置好了代理，在 `vite.config.ts` 中：
- 前端开发服务器：`http://localhost:3000`
- 后端API地址：`http://localhost:8080`
- 代理规则：所有 `/api` 开头的请求会被代理到后端

### API请求流程
```
前端请求: /api/auth/login
    ↓
Vite代理转发: http://localhost:8080/api/auth/login
    ↓
后端处理并返回响应
```

## 🐛 常见问题

### 1. 后端启动失败 - 端口被占用
**错误信息：** `Address already in use`

**解决方法：**
- 检查8080端口是否被占用：`lsof -i :8080`
- 如果被占用，可以修改 `main.py` 最后一行改为其他端口，比如 `port=8081`
- 同时需要修改 `vite.config.ts` 中的 `target: 'http://localhost:8081'`

### 2. 前端请求失败 - CORS错误
**错误信息：** `Access to XMLHttpRequest has been blocked by CORS policy`

**解决方法：**
- 检查后端 `main.py` 中的 CORS 配置是否正确
- 确认 `allow_origins` 包含 `http://localhost:3000`

### 3. 后端依赖安装失败
**解决方法：**
- 确保Python版本 >= 3.8：`python --version`
- 尝试升级pip：`pip install --upgrade pip`
- 使用虚拟环境（推荐）：
  ```bash
  python -m venv venv
  source venv/bin/activate  # Mac/Linux
  # 或 venv\Scripts\activate  # Windows
  pip install -r requirements.txt
  ```

### 4. 数据库文件不存在
**解决方法：**
- 后端启动时会自动创建数据库文件 `test.db`
- 如果遇到问题，删除 `test.db` 文件，重新启动后端服务

### 5. Token认证失败
**错误信息：** `401 Unauthorized`

**解决方法：**
- 确保登录后token已保存到localStorage
- 检查请求头中是否包含 `Authorization: Bearer <token>`
- 检查后端 `auth.py` 中的 `SECRET_KEY` 是否一致

## 📝 开发建议

### 1. 使用两个终端窗口
- **终端1：** 运行后端服务（保持运行）
- **终端2：** 运行前端服务（保持运行）

### 2. 查看API文档
后端启动后，访问 http://localhost:8080/docs 可以：
- 查看所有API接口
- 在线测试API
- 查看请求/响应格式

### 3. 调试技巧
- **后端日志：** 在后端终端查看请求日志
- **前端控制台：** 在浏览器F12开发者工具查看网络请求
- **后端调试：** 使用 `print()` 或日志库输出调试信息

## ✅ 验证清单

完成以下检查，确保前后端连接正常：

- [ ] 后端服务成功启动（端口8080）
- [ ] 可以访问 http://localhost:8080/docs
- [ ] 前端服务成功启动（端口3000）
- [ ] 可以访问 http://localhost:3000
- [ ] 可以成功注册用户
- [ ] 可以成功登录并获取token
- [ ] 可以创建作品
- [ ] 可以查看作品列表
- [ ] 可以查看消费记录

## 🎉 完成！

如果以上步骤都成功，恭喜你！前后端已经成功连接，可以开始开发了。

如有任何问题，请查看：
1. 后端终端输出的错误信息
2. 浏览器控制台的错误信息（F12）
3. 后端API文档：http://localhost:8080/docs

